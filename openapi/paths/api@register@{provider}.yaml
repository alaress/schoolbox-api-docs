post:
  operationId: mobileRegister
  tags: [mobile]
  summary: Register mobile device
  security: []
  description: In order to register your app to receive push notifications you first need to notify Schoolbox of a valid user and the app identifier. This process is handled via a POST call as specified below.
  parameters:
    - name: provider
      in: path
      description: |
        The provider that will handle the sending of push notifications to the device.

        While Apple (APNS) and Google Android (GCM) are still supported, they are deprecated.
      required: true
      example: 'Firebase'
      schema:
        type: string
        enum:
          - GCM
          - APNS
          - Firebase
          - Digistorm
  requestBody:
    $ref: ../components/requestBodies/registration.yaml
  responses:
    '201':
      $ref: ../components/responses/authentication-successUser.yaml
    '400':
      description: |
        This error occurs when the registration request cannot be processed due to a missing or invalid parameter.
      content:
        text/plain:
          schema:
            type: string
          examples:
            invalidProvider:
              summary: Invalid provider
              value: "Invalid provider: 'invalid_slug'. Accepted providers are: APNS, GCM, Digistorm, Firebase"
        application/json:
          schema:
            type: object
            properties:
              required:
                type: string
                description: Error message indicating required fields
          examples:
            missingCredentials:
              summary: Missing authentication credentials
              value:
                required: "Either the \"username\" and \"password\" or the \"jwt\" POST fields must be set"
    '401':
      $ref: ../components/responses/authentication-failed.yaml
    default:
      $ref: ../components/responses/problem.yaml

delete:
  operationId: mobileDeregister
  tags: [mobile]
  summary: Deregister mobile device
  security: []
  description: |
    Removes a registered device from receiving push notifications.    
  parameters:
    - name: provider
      in: path
      description: |
        The type of device that is connecting to the service.

        Only "Firebase" is currently supported for deregistration.
      required: true
      example: 'Firebase'
      schema:
        type: string
        enum:
          - GCM
          - APNS
          - Firebase
          - Digistorm
  requestBody:
    $ref: ../components/requestBodies/mobile-deregistration.yaml
  responses:
    '200':
      description: Device successfully deregistered
      content:
        text/plain:
          schema:
            type: string
    '400':
      description: |
        This error occurs when the deregistration request cannot be processed. Common causes include:
        - An unsupported provider specified in the path parameter
        - No matching registration found for the provided device token and app ID combination
      content:
        text/plain:
          schema:
            type: string
          examples:
            invalidProvider:
              summary: Invalid provider
              value: "Invalid provider: 'invalid_slug'. Accepted providers are: APNS, GCM, Digistorm, Firebase"
            notFound:
              summary: Registration not found
              value: "Unable to find app registration"
            missingBody:
              summary: Missing request body
              value: "We should have done something before this..."
    default:
      $ref: ../components/responses/problem.yaml

